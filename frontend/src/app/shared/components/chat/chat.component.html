<div
  class="bg-orange-200 dark:bg-slate-950 text-white shadow-lg flex flex-col rounded-2xl overflow-hidden fixed bottom-20 right-4 h-3/4 max-h-[600px] w-[300px] lg:w-[400px]"
>
  <div
    class="bg-orange-200 dark:bg-slate-950 p-4 border-none text-center dark:text-gray-300 text-gray-700"
  >
    <h2 class="text-lg font-semibold">{{ "chat.TITLE" | translate }}</h2>
  </div>
  <div
    class="flex flex-col gap-3 p-4 relative flex-grow justify-between overflow-hidden"
  >
    <div
      class="flex flex-col gap-3 px-4 py-3 overflow-y-scroll max-h-[80%]"
      #messageContainer
    >
      @for (message of messages; track message.id) {
      <div class="flex flex-col gap-1 max-w-[250px] lg:max-w-[350px]">
        <div class="flex gap-2 items-center">
          <app-profile-icon
            size="md"
            [firstName]="message.sender.firstName"
            [lastName]="message.sender.lastName"
            [hover]="false"
          />
          <div class="flex h-full items-center gap-2">
            @if (message.sender.username === currentUser?.username) {
            <span class="text-sky-600 text-sm font-semibold">You</span>
            } @else {
            <span class="text-sky-300 text-sm"
              >{{ message.sender.firstName }}
              {{ message.sender.lastName }}</span
            >
            }
            <span class="text-gray-500 text-sm">{{
              message.createdAt | date : "medium"
            }}</span>
          </div>
        </div>
        <div class="text-sm break-words text-gray-600 dark:text-gray-200">
          {{ message.content }}
        </div>
      </div>
      }
    </div>
    <div
      class="flex items-center bg-orange-200 text-gray-800 dark:bg-slate-950 dark:text-gray-200 shadow-lg chat-input rounded-full focus-within:ring-2 dark:focus-within:ring-slate-600 focus-within:ring-orange-300 px-4 py-3 h-12 relative"
    >
      @if (showEmojiPicker) {
      <div
        class="absolute bottom-12 right-0 z-50 bg-orange-200 dark:bg-slate-950 shadow-2xl"
      >
        <emoji-mart
          [darkMode]="true"
          [showPreview]="false"
          [perLine]="5"
          color="#020617"
          [emojiSize]="30"
          [style]="{
            backgroundColor: 'transparent',
            border: 'none',
            borderRadius: ' 0.5rem'
          }"
          [i18n]="{
              search: 'Emoji...',
            }"
          (emojiClick)="addEmoji($event)"
        />
      </div>
      }
      <input
        type="text"
        [placeholder]="'chat.INPUT_PLACEHOLDER' | translate"
        class="flex-1 bg-transparent text-sm focus:outline-none placeholder:text-gray-500 disabled:cursor-not-allowed"
        (input)="onTypeMessage($event)"
        [(ngModel)]="message"
        [disabled]="isLoading()"
        (keydown.enter)="sendMessage()"
      />
      <button
        class="flex justify-center items-center rounded-full w-8 h-8 aspect-square text-gray-500 hover:text-gray-400 transition-all disabled:cursor-not-allowed"
        (click)="toggleEmojiPicker()"
        [disabled]="isLoading()"
      >
        <mat-icon class="text-base">sentiment_satisfied_alt</mat-icon>
      </button>
      @if (message.length > 0) {
      <button
        @buttonAnimation
        class="focus:outline-none flex justify-center items-center bg-orange-100 hover:bg-orange-300 dark:bg-slate-900 rounded-full w-8 h-8 aspect-square dark:hover:bg-slate-800 transition-all disabled:cursor-not-allowed"
        [disabled]="isLoading()"
        (click)="sendMessage()"
      >
        <mat-icon class="text-gray-800 dark:text-gray-200 text-base"
          >north</mat-icon
        >
      </button>
      }
    </div>
  </div>
</div>
