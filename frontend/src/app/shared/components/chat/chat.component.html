<div
  class="fixed bottom-20 right-4 z-40 flex h-3/4 max-h-[600px] w-[300px] origin-bottom-right flex-col overflow-hidden rounded-2xl bg-orange-200 text-white shadow-lg dark:bg-slate-950 lg:w-[400px]"
  [@chatAnimation]
>
  <div
    class="border-none bg-orange-200 p-4 text-center text-gray-700 dark:bg-slate-950 dark:text-gray-300"
  >
    <h2 class="text-lg font-semibold">{{ "chat.TITLE" | translate }}</h2>
  </div>
  <div
    class="relative flex grow flex-col justify-between gap-3 overflow-hidden p-4"
  >
    <div
      class="flex max-h-[80%] flex-col gap-3 overflow-y-scroll px-4 py-3"
      #scroll
    >
      @for (message of messages; track message.id) {
        <div class="flex max-w-[250px] flex-col gap-1 lg:max-w-[350px]">
          <div class="flex items-center gap-2">
            <app-profile-icon
              size="md"
              [firstName]="message.sender.firstName"
              [lastName]="message.sender.lastName"
              [hover]="false"
            />
            <div class="flex h-full items-center gap-2">
              @if (message.sender.username === currentUser?.username) {
                <span class="text-sm font-semibold text-sky-600">You</span>
              } @else {
                <span class="text-sm text-sky-300"
                  >{{ message.sender.firstName }}
                  {{ message.sender.lastName }}</span
                >
              }
              <span class="text-sm text-gray-500">{{
                message.createdAt | date: "medium"
              }}</span>
            </div>
          </div>
          <div class="break-words text-sm text-gray-600 dark:text-gray-200">
            {{ message.content }}
          </div>
        </div>
      }
    </div>
    <div
      class="chat-input relative flex h-12 items-center rounded-full bg-orange-200 px-4 py-3 text-gray-800 shadow-lg focus-within:ring-2 focus-within:ring-orange-300 dark:bg-slate-950 dark:text-gray-200 dark:focus-within:ring-slate-600"
    >
      @if (showEmojiPicker) {
        <div
          class="absolute bottom-12 right-0 z-50 bg-orange-200 shadow-2xl dark:bg-slate-950"
        >
          <emoji-mart
            [darkMode]="true"
            [showPreview]="false"
            [perLine]="5"
            color="#020617"
            [emojiSize]="30"
            [style]="{
              backgroundColor: 'transparent',
              border: 'none',
              borderRadius: ' 0.5rem',
            }"
            [i18n]="{
              search: 'Emoji...',
            }"
            (emojiClick)="addEmoji($event)"
          />
        </div>
      }
      <input
        type="text"
        [placeholder]="'chat.INPUT_PLACEHOLDER' | translate"
        class="flex-1 bg-transparent text-sm placeholder:text-gray-500 focus-visible:outline-hidden disabled:cursor-not-allowed"
        [formControl]="form"
        (keydown.enter)="sendMessage()"
      />
      <button
        class="flex aspect-square h-8 w-8 items-center justify-center rounded-full text-gray-500 transition-all hover:text-gray-400 disabled:cursor-not-allowed"
        (click)="toggleEmojiPicker()"
        [disabled]="loading"
      >
        <mat-icon class="text-base">sentiment_satisfied_alt</mat-icon>
      </button>
      @if (form.value && form.value.length > 0) {
        <button
          @buttonAnimation
          class="flex aspect-square h-8 w-8 items-center justify-center rounded-full bg-orange-100 transition-all hover:bg-orange-300 focus-visible:outline-hidden disabled:cursor-not-allowed dark:bg-slate-900 dark:hover:bg-slate-800"
          [disabled]="loading"
          (click)="sendMessage()"
        >
          <mat-icon class="text-base text-gray-800 dark:text-gray-200"
            >north</mat-icon
          >
        </button>
      }
    </div>
  </div>
</div>
