@if (isLoading()) {
<app-spinner />
} @else {
<div class="flex flex-col gap-5 w-full">
  <form
    [formGroup]="form"
    (ngSubmit)="onSubmit()"
    class="flex flex-col gap-2 mx-auto"
  >
    <div class="flex flex-col lg:flex-row gap-2">
      <input
        id="description"
        type="text"
        formControlName="description"
        placeholder="Enter task description"
        class="p-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-950 placeholder-slate-600 self-end"
      />
      <div class="flex flex-col gap-1">
        <label for="dueDate" class="text-gray-400 self-center">Due date:</label>
        <input
          id="dueDate"
          type="date"
          formControlName="dueDate"
          class="p-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-950"
        />
      </div>
      <div class="flex flex-col gap-1">
        <label for="status" class="text-gray-400 self-center">Status:</label>
        <select
          id="status"
          formControlName="status"
          class="w-full p-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-950"
        >
          <option value="" disabled>Select status</option>
          @for (status of statuses; track status) {
          <option [value]="status">
            {{ status }}
          </option>
          }
        </select>
      </div>
      <div class="flex flex-col gap-1">
        <label for="priority" class="text-gray-400 self-center"
          >Priority:</label
        >
        <select
          id="priority"
          formControlName="priority"
          class="w-full p-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-950"
        >
          <option value="" disabled>Select priority</option>
          @for (priority of priorities; track priority) {
          <option [value]="priority">
            {{ priority }}
          </option>
          }
        </select>
      </div>
      <div class="flex flex-col gap-2 self-end">
        <button
          (click)="onReset()"
          class="px-1.5 py-1 bg-slate-900 flex justify-center items-center rounded-md text-slate-300"
        >
          <p class="text-xs">reset</p>
        </button>
        <button
          type="submit"
          class="px-1.5 py-1 bg-sky-500 flex justify-center items-center rounded-md text-white"
        >
          <p class="text-xs">save</p>
        </button>
      </div>
    </div>
    @if (descriptionIsInvalid) {
    <p class="text-red-500 text-sm">
      Description name must contain between 2 and 120 characters.
    </p>
    }
  </form>
  <div class="flex flex-col lg:flex-row gap-10 flex-grow">
    <div class="flex flex-col gap-10 text-gray-500 flex-grow">
      <div class="flex flex-col gap-3">
        <div
          class="flex py-1 px-3 gap-2 items-center bg-white lg:mr-auto rounded-full border-gray-300 text-slate-950 overflow-hidden"
          (click)="focusSearchInput()"
        >
          <mat-icon>search</mat-icon>
          <input
            type="text"
            [formControl]="searchControl"
            placeholder="Search users"
            class="focus:outline-none focus:ring-0"
            #searchInput
          />
        </div>
        <ul class="text-sm divide-y divide-slate-600">
          @for (user of paginatedUsers(); track user.userName) {
          <li
            class="flex justify-between items-center p-2 gap-1 text-slate-400"
          >
            <div
              class="flex gap-2 cursor-pointer"
              routerLink="/users/{{ user.userName }}"
            >
              <div
                class="bg-sky-500 text-gray-200 font-semibold p-2 rounded-full aspect-square h-10 flex justify-center items-center"
              >
                {{ user.firstName.charAt(0) + user.lastName.charAt(0) }}
              </div>
              <p class="flex items-center gap-1">
                {{ user.firstName }} {{ user.lastName }}
                <span class="text-slate-600">({{ user.userName }})</span>
              </p>
            </div>
            <button
              class="bg-slate-300 text-slate-900 flex justify-center items-center rounded-full p-0.5 hover:bg-slate-400 transition-all"
            >
              <mat-icon class="text-base">person_remove</mat-icon>
            </button>
          </li>
          }
        </ul>
        <mat-paginator
          [length]="filteredUsers().length"
          [pageSize]="pageSize"
          [pageIndex]="currentPage"
          (page)="pageChanged($event)"
        ></mat-paginator>
      </div>
      <div class="flex flex-col gap-4 mx-auto items-center">
        <p class="text-gray-400">Add user</p>
        <app-inline-search [usersAlreadyIn]="taskMembersNicknames" />
      </div>
    </div>
    <app-chat [customPosition]="'flex min-h-[400px] h-full lg:w-[400px]'" />
  </div>
</div>
}
